<!IDOCTYPE html>

<html>
	<head>
		<title>CGPA Calculator</title>
		<meta charset="utf-8">
		<meta name="keywords" content="CGPA Calculator" />
		<meta name="description" content="Calculate CGPA for selected trimester" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<style>
		.button{
			background-color: #90caf9;
		    border: none;
		    text-align: center;
		    text-decoration: none;
		    display: inline-block;
		    font-size: 16px;
		    padding: 10px 15px;
		}
		.deleteButton{
			border:2px solid black;
			background-color: #ef5350;
		}
		.subjectFloat{ float:left; }
		</style>
	</head>
	<body>
		<div class="subjectcounter" id="stemplate" style="display: none; margin-bottom: 5px;">
			<fieldset>
				<legend><div class="subjectno"><strong></strong></div></legend>
				<div class="subjectFloat" style="margin-right: 20px;">Name : <input type="text" class="subjectname" size="70"></div>
				<div class="subjectFloat" style="margin-right: 20px;">Year : 
				<select class="year" onchange="calculateGPA();">
					<option style="display:none"></option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
				</select>
				</div>
				<div class="subjectFloat" style="margin-right: 20px;";>Trimester : 
				<select class="trimester" onchange="calculateGPA();">
					<option style="display:none"></option>
				  	<option value="1">1</option>
				  	<option value="2">2</option>
				  	<option value="3">3</option>
				</select>
				</div>
				<div class="subjectFloat" style="margin-right: 20px;">Credit Hour : <input type="text" class="credithour" size="4" oninput="calculateGPA();"></div>
				<div class="subjectFloat" style="margin-right: 20px;">Grades : 
				<select class="subjectgrade" onchange="calculateGPA();">
					<option style="display:none"></option>
					<option value="4.00">A+</option>
					<option value="4.00">A</option>
					<option value="3.67">A-</option>
					<option value="3.33">B+</option>
					<option value="3.00">B</option>
					<option value="2.67">B-</option>
					<option value="2.33">C+</option>
					<option value="2.00">C</option>
					<option value="1.67">C-</option>
					<option value="1.33">D+</option>
					<option value="1.00">D</option>
					<option value="0.00">F</option>
				</select>
				</div>
				<div class="subjectFloat"><button class="deleteButton" type="button" onclick="delSubject(this);">X</div>
			</fieldset>
		</div>

		<h1>MMU CGPA Calculator</h1>
		<form method="post" action="">
			<br>
			<button class="button" type="button" onclick="addSubject();">Add Subject</button>
			<button class="button" type="button" onclick="clearForm(this.form);">Clear</button>
			<br><br>
			<fieldset>
				<div id="Subject">
					<legend><h2><strong>Subject List :</strong></h2></legend>
				</div>
				<br>
				<label>Select year and trimester : </label>
				<select class="time" onchange="calculateGPA();">
					<option style="display:none"></option>
					<option value="0">Year 1 Trimester 1</option>
					<option value="1">Year 1 Trimester 2</option>
					<option value="2">Year 1 Trimester 3</option>
					<option value="3">Year 2 Trimester 1</option>
					<option value="4">Year 2 Trimester 2</option>
					<option value="5">Year 2 Trimester 3</option>
					<option value="6">Year 3 Trimester 1</option>
					<option value="7">Year 3 Trimester 2</option>
					<option value="8">Year 3 Trimester 3</option>
					<option value="9">Year 4 Trimester 1</option>
					<option value="10">Year 4 Trimester 2</option>
					<option value="11">Year 4 Trimester 3</option>
				</select>
				<br>
				<label>GPA : </label>
				<label id="mingpa">NaN</label><label> - </label><label id="maxgpa">NaN</label>
				<br>
				<label>CGPA : </label>
				<label id="mincgpa">NaN</label><label> - </label><label id="maxcgpa">NaN</label>
			</fieldset>
		</form>

	<script>
		var scounter = 1;
		var cgpa = 0.00;
		var maxcgpa = 0.00;
		var totalGradePoint = 0.00;
		var totalCreditHour = 0;
		var totalMaxGradePoint = 0.00;
		var gpa = new Array(12);
		var maxgpa = new Array(12);
		var totalGradePoints = new Array(12);
		var totalCreditHours = new Array(12);
		var totalMaxGradePoints = new Array(12);

		function update(){
			for(i=1; i<scounter; i++){
				document.getElementsByClassName("subjectno")[i].innerHTML = "Subject "+i; // update showing subject number
				document.getElementsByClassName("subjectcounter")[i].id = i; // update showing subject number
			}
		}
		function addSubject(){
		    var getTemplate = document.getElementById("stemplate");
			var newElement = getTemplate.cloneNode(true);
		    newElement.style.display = "block";
			document.getElementById("Subject").appendChild(newElement);
			scounter+=1;
			update();
			calculateGPA();
		}
		function delSubject(button){
			var subjectDiv = button.parentNode.parentNode.parentNode.parentNode;
			subjectDiv.removeChild(button.parentNode.parentNode.parentNode);
			scounter-=1;
			update();
			calculateGPA();
		}
		function checkMax(mingradepoint){
			if(mingradepoint==4.00)
				return 4.00;
			if(mingradepoint==3.67)
				return 3.99;
			if(mingradepoint==3.33)
				return 3.66;
			if(mingradepoint==3.00)
				return 3.32;
			if(mingradepoint==2.67)
				return 2.99;
			if(mingradepoint==2.33)
				return 2.66;
			if(mingradepoint==2.00)
				return 2.32;
			if(mingradepoint==1.67)
				return 1.99;
			if(mingradepoint==1.33)
				return 1.66;
			if(mingradepoint==1.00)
				return 1.32;
			if(mingradepoint==0.00)
				return 0.99;
		}
		function calculateGPA(){
			for(i=0; i<12; i++){ gpa[i]=0.00; }
			for(i=0; i<12; i++){ totalGradePoints[i]=0.00; }
			for(i=0; i<12; i++){ totalMaxGradePoints[i]=0.00; }
			for(i=0; i<12; i++){ totalCreditHours[i]=0.00; }
			for(i=1; i<scounter; i++){
				var currentDiv = document.getElementById(i);
				var currentYear = currentDiv.getElementsByClassName("year")[0];
				var currentTrimester = currentDiv.getElementsByClassName("trimester")[0];
				var gradeTarget = currentDiv.getElementsByClassName("subjectgrade")[0];
				var creditHourTarget = currentDiv.getElementsByClassName("credithour")[0];
				totalGradePoints[((parseInt(currentYear.value)-1)*3)+parseInt(currentTrimester.value)-1] += (parseFloat(gradeTarget.value)*parseInt(creditHourTarget.value));
				totalCreditHours[((parseInt(currentYear.value)-1)*3)+parseInt(currentTrimester.value)-1] += parseInt(creditHourTarget.value);
				totalMaxGradePoints[((parseInt(currentYear.value)-1)*3)+parseInt(currentTrimester.value)-1] += (checkMax(parseFloat(gradeTarget.value))*parseInt(creditHourTarget.value));
			}
			for(i=0; i<12; i++){
				gpa[i] = totalGradePoints[i]/totalCreditHours[i];
				maxgpa[i] = totalMaxGradePoints[i]/totalCreditHours[i];
			}
			// calculate cgpa
			totalGradePoint = 0.00;
			totalMaxGradePoint = 0.00;
			totalCreditHour = 0;
			for(i=0; i<12; i++){
				totalGradePoint += totalGradePoints[i];
				totalCreditHour += totalCreditHours[i];
				totalMaxGradePoint += totalMaxGradePoints[i];
			}
			cgpa = totalGradePoint/totalCreditHour;
			maxcgpa = totalMaxGradePoint/totalCreditHour;
			
			// Update gpa if current selection is available
			var time = document.getElementsByClassName("time")[0];
			if(gpa[parseInt(time.value)]>0){
				document.getElementById("mingpa").innerHTML = gpa[parseInt(time.value)].toFixed(2);
				document.getElementById("maxgpa").innerHTML = maxgpa[parseInt(time.value)].toFixed(2); 
			}
			else{
				document.getElementById("mingpa").innerHTML = "NaN";
				document.getElementById("maxgpa").innerHTML = "NaN";
			}

			if(cgpa > 0){
				document.getElementById("mincgpa").innerHTML = cgpa.toFixed(2);
				document.getElementById("maxcgpa").innerHTML = maxcgpa.toFixed(2);
			}
			else{
				document.getElementById("mincgpa").innerHTML = "NaN";
				document.getElementById("maxcgpa").innerHTML = "NaN";
			}
		}
		function clearForm(oForm) {
			var elements = oForm.elements; 
			oForm.reset();
			for(i=0; i<elements.length; i++) {
				field_type = elements[i].type.toLowerCase();
				switch(field_type) {
					case "text": 
					case "password": 
					case "textarea":
					case "hidden":   
						elements[i].value = ""; 
						break;
					case "radio":
					case "checkbox":
					    if (elements[i].checked) {
					    	elements[i].checked = false; 
					  	}
						break;
					case "select-one":
					case "select-multi":
					    elements[i].selectedIndex = -1;
						break;
					default: 
						break;
				}
		   	}
		   	calculateGPA();
		}
	</script>
	</body>
</html>